# 项目日志：Figma to Print-Ready PDF 自动化流程

**最后更新时间**: 2025-08-19

## 1. 项目总体目标

创建一个完整的自动化工作流，允许用户从 Figma 设计稿开始，通过自定义的颜色映射，最终生成一个颜色精确、保留矢量格式、可直接交付印刷的 PDF 文件。

---

## 2. 已完成模块和状态

### 模块一：PDF 颜色转换与处理脚本

- **状态**: ✅ **完成并已验证**
- **目的**: 将一个标准的RGB PDF，根据JSON映射表，转换为颜色精确的CMYK印刷级PDF。
- **技术栈**: `Python`, `pikepdf` 库, `Ghostscript`
- **核心文件**: `process_pdf.py`, `color_mapping.json`
- **关键技术点**:
    1.  采用两步流程，先替换颜色再进行标准化，以确保稳定性和精确性。
    2.  使用 `pikepdf` 在PDF底层内容流中直接将RGB颜色定义替换为指定的CMYK颜色定义，保证了100%的颜色准确性。
    3.  调用 `Ghostscript` 时，使用 `-dUseCIEColor=false` 参数禁用了其自动色彩管理，这是成功保留精确CMYK值的关键。
    4.  最终脚本能生成保留矢量格式的现代化PDF，避免了内容被栅格化（变成图片）的问题。

### 模块二：Figma 插件

- **状态**: ✅ **基础功能已搭建**
- **目的**: 在 Figma 环境中提供一个图形界面，让用户可以方便地选择颜色、设置CMYK映射值，并一键导出源PDF和对应的`color_mapping.json`文件。
- **技术栈**: `Figma 插件 API`, `TypeScript`, `HTML/CSS`
- **核心文件**: `manifest.json`, `code.ts`, `ui.html`
- **关键技术点**:
    1.  插件UI (`ui.html`) 与核心逻辑 (`code.ts`) 通过消息传递进行通信。
    2.  能通过 `figma.on('selectionchange')` 自动检测用户选择的元素并提取其中的纯色。
    3.  UI界面能动态展示所选颜色，并提供CMYK输入框。
    4.  导出功能通过 `figma.exportAsync` 实现PDF导出，并通过 `postMessage` 将文件数据发送回UI，由UI的JS代码触发浏览器下载。

---

## 3. 后续步骤 (To-Do)

1.  **测试 Figma 插件**: 您需要按照说明，在Figma桌面应用中加载并实际测试插件的功能是否符合预期。
2.  **部署与整合**: 
    -   **本地流程**: 您现在可以在本地使用“Figma插件导出 -> 手动运行Python脚本”的流程。
    -   **云端自动化 (可选)**: 未来的一个方向，可以将Python脚本部署到一个云服务器或云函数上。Figma插件导出文件后，可以手动上传到云端触发自动处理，实现完全的云端自动化。
3.  **优化与迭代**: 根据实际使用情况，可能需要对Figma插件的UI/UX或Python脚本的错误处理等进行优化。
